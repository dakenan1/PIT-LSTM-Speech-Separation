# LSTM/BLSTM based PIT for Two Speakers
The progress made in multitalker mixed speech separation and recognition, often referred to as the "cocktail-party problem", has been less impressive. Although human listeners can easily perceive separate sources in an acoustic mixture, the same task seems to be extremely difficult for computers, especially when only a single microphone recording the mixed-speech.

<img width="75%" height="75%" src="8.Result picture/spectrogram.PNG"/>

## 1. Speration Performance
Notice: The training set and the validation set that contain two-speaker mixtures generated by randomly selecting speakers and utterances from the WSJ0 set, and mixing them at various signal-to-noise ratios (SNRs) uniformly chosen between -2.5 dB and 2.5 dB. <br>

For **LSTM**, results of the mixed audio with different gender are as follows:

<img width="75%" height="75%" src="8.Result picture/LSTM-result.png"/>

For **BLSTM**, results of the mixed audio with different gender are as follows:

<img width="75%" height="75%" src="8.Result picture/BLSTM-result.png"/>

From above results we can see that the separation effect of mixed gender audio is better than that of the same gender and BLSTM performs better than LSTM.

## 2. Evaluation Criterion
* SDR: Signal to Distortion Ratio
* SAR: Signal to Artifact Ratio
* SIR: Signal to Interference Ratio
* STOI: Short Time Objective Intelligibility Measure
* ESTOI: Extended Short Time Objective Intelligibility Measure
* PESQ: Perceptual Evaluation of Speech Quality

## 3. Dependency Library
* [librosa](https://librosa.github.io/)
* matlab (my test version: R2016b 64-bit)
* tensorflow (my test version: 1.4.0)
* anaconda3 (Python3.5+)

## 4. Usage Process
#### Generate Mixed and Target Speech:
When you have WSJ0 data, you can use the code "create-speaker-mixtures-V1/V2" to create the mixed speech. We mixed 2-speaker audios with samplerate 8000.

#### Run the command line script:
```bash
bash run.sh
```
which contains three steps:
1. Extract STFT features, and convert them to the tfrecords format of Tensorflow.
The training data is ready here. The file structure of training data is now as follows:
```
storage/
├── lists
│   ├── cv_tf.lst
│   ├── cv_wav.lst
│   ├── tr_tf.lst
│   ├── tr_wav.lst
│   ├── tt_tf.lst
│   └── tt_wav.lst
├── separated
├── TFCheckpoint
└── tfrecords
    ├── cv_tfrecord
    │   ├── 01aa010k_1.3053_01po0310_-1.3053.tfrecords
    │   ├── 01aa010p_0.93798_02bo0311_-0.93798.tfrecords
    │   ├── ...
    │   └── 409o0317_1.2437_025c0217_-1.2437.tfrecords
    ├── tr_tfrecord
    │   ├── 01aa010b_0.97482_209a010p_-0.97482.tfrecords
    │   ├── 01aa010b_1.4476_20aa010p_-1.4476.tfrecords
    │   ├── ...
    │   └── 409o0316_1.3942_20oo010p_-1.3942.tfrecords
    └── tt_tfrecord
        ├── 050a050a_0.032494_446o030v_-0.032494.tfrecords
        ├── 050a050a_1.7521_422c020j_-1.7521.tfrecords
        ├── ...
        └── 447o0312_2.0302_440c0206_-2.0302.tfrecords
```
Note: {tr,cv,tt}_wav.lst is like as follows:
```
447o030v_0.1232_050c0109_-0.1232.wav
447o030v_1.7882_444o0310_-1.7882.wav
...
447o030x_0.98832_441o0308_-0.98832.wav
447o030x_1.4783_422o030p_-1.4783.wav
```
And {tr,cv,tt}_tf.lst is like as follows:
```
storage/tfrecords/cv_tfrecord/011o031b_1.8_206a010u_-1.8.tfrecords
storage/tfrecords/cv_tfrecord/20ec0109_0.47371_020c020q_-0.47371.tfrecords
...
storage/tfrecords/cv_tfrecord/01zo030l_0.6242_40ho030s_-0.6242.tfrecords
storage/tfrecords/cv_tfrecord/20fo0109_1.1429_017o030p_-1.1429.tfrecords
```
2. Train the deep learning neural network.
3. Decode the network to generate separation audios.

## 5. File Description
* 1.create-speaker-mixtures-V1: Version one of scripts to generate the wsj0-mix multi-speaker dataset.
* 2.create-speaker-mixtures-V2: Version two of scripts to generate the wsj0-mix multi-speaker dataset.
* 3.SPHFile2Wav: Converting SPH format of TIMIT and WSJ0 corpus into wav format.
* 4.introduction_to_mask: tntroduction to the Computational Auditory Scene Analysis (mask-based method) in speech separation.

**mixed speech**:

<img width="55%" height="55%" src="4. introduction_to_mask/mixturesignals.png"/>

**masks**:

<img width="90%" height="90%" src="4. introduction_to_mask/masks.png"/>

**recovered speech 1**:

<img width="50%" height="50%" src="4. introduction_to_mask/recoverd1.png"/>

**recovered speech 2**:

<img width="50%" height="50%" src="4. introduction_to_mask/recoverd2.png"/>

* 5.step_to_CASA_DL: Step to multi-speaker speech separation with Computational Auditory Scene Analysis and Deep Learning.
* 6.separated_result_LSTM: Demos of separated speech based on LSTM and PIT.
* 7.separated_result_BLSTM: Demos of separated speech based on BLSTM and PIT.

## 6. Reference Paper & Code
*Thank Dong Yu et al. for the paper and Sining Sun (Northwestern Polytechnical University, China) et al. for sharing their code.*
* __Paper__: Permutation Invariant Training of Deep Models for Speaker-Independent Multi-talker Speech Separation.
* __Authors__: Dong Yu, Morten Kolbæk, Zheng-Hua Tan, Jesper Jensen
* __Published__: [ICASSP 2017](https://ieeexplore.ieee.org/document/7952154/) (5-9 March 2017)
* __Dataset__: [WSJ0 data](https://catalog.ldc.upenn.edu/ldc93s6a), [VCTK-Corpus](http://homepages.inf.ed.ac.uk/jyamagis/page3/page58/page58.html)

* SDR/SAR/SIR-STOI/ESTOI-PESQ:
    * My github: [Speech-measure-SDR-SAR-STOI-PESQ](https://github.com/dakenan1/Speech-measure-SDR-SAR-STOI-PESQ) 

## 7. Directions of Future Research
* Scaling down DNNs without compromising performance.
* Multiple microphone algorithms.
* Beyond single-modality algorithm, for example, visual perception.
* Beyond the Mean Squared Error Cost Function
* Towards Time-Domain End-to-End system.

*I will study on speech separation for a long time. You can pay close attention to my recent work and follow me if interested. Thanks for your attention!* 
